import React, { useState } from "react";
import { useProject } from "../ProjectContext";

export default function UploadPage() {
  const { updateProjectData } = useProject();

  const [content, setContent] = useState("");
  const [apiKey, setApiKey] = useState("");
  const [file, setFile] = useState(null);
  const [linkInput, setLinkInput] = useState("");
  const [loading, setLoading] = useState(false);

  // íŒŒì¼ ì—…ë¡œë“œ ì‹œ í…ìŠ¤íŠ¸ ì¶”ì¶œ í•¨ìˆ˜
  const handleFileUpload = async (e) => {
    const uploadedFile = e.target.files[0];
    setFile(uploadedFile);

    if (uploadedFile.type === "application/pdf") {
      const text = await uploadedFile.text();
      setContent(text);
    } else {
      const text = await uploadedFile.text();
      setContent(text);
    }
  };

  // ìµœì¢… ì—…ë¡œë“œ ì²˜ë¦¬
  const handleSubmit = () => {
    updateProjectData({
      isLoaded: true,
      type: file ? "file" : linkInput ? "youtube" : "text",
      fileName: file ? file.name : "text-input",
      content: file ? content : linkInput ? linkInput : content,
      apiKey: apiKey,                     // ğŸ”¥ ì¶”ê°€ë¨
      uploadDate: new Date().toISOString(),
      summary: "",                        // ì´í›„ NotesPageì—ì„œ ìƒì„±
      quiz: ""                            // QuizPageì—ì„œ ìƒì„±
    });

    alert("ì—…ë¡œë“œ ì™„ë£Œ! ì´ì œ ë‹¤ìŒ í˜ì´ì§€ì—ì„œ ìš”ì•½/ì—°ìŠµë¬¸ì œë¥¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.");
  };

  return (
    <div style={{ padding: "24px" }}>
      <h2>ğŸ“„ í•™ìŠµ ìë£Œ ì—…ë¡œë“œ</h2>

      {/* ğŸ”¥ API Key ì…ë ¥ */}
      <div style={{ marginBottom: "20px" }}>
        <label>OpenAI API Key ì…ë ¥</label>
        <input
          type="password"
          value={apiKey}
          placeholder="sk-ë¡œ ì‹œì‘í•˜ëŠ” API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”"
          onChange={(e) => setApiKey(e.target.value)}
          style={{ width: "100%", padding: "8px", marginTop: "6px" }}
        />
      </div>

      {/* ğŸ”¥ íŒŒì¼ ì—…ë¡œë“œ */}
      <div style={{ marginBottom: "20px" }}>
        <label>íŒŒì¼ ì—…ë¡œë“œ</label>
        <input type="file" accept=".txt,.pdf" onChange={handleFileUpload} />
      </div>

      {/* ğŸ”¥ í…ìŠ¤íŠ¸ ì§ì ‘ ì…ë ¥ */}
      <div style={{ marginBottom: "20px" }}>
        <label>í…ìŠ¤íŠ¸ ì…ë ¥</label>
        <textarea
          placeholder="ì—¬ê¸°ì— í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•  ìˆ˜ë„ ìˆì–´ìš”."
          value={content}
          onChange={(e) => setContent(e.target.value)}
          rows={5}
          style={{ width: "100%", padding: "8px" }}
        />
      </div>

      {/* ğŸ”¥ ìœ íŠœë¸Œ ë§í¬ ì—…ë¡œë“œ */}
      <div style={{ marginBottom: "20px" }}>
        <label>ìœ íŠœë¸Œ ë§í¬</label>
        <input
          value={linkInput}
          onChange={(e) => setLinkInput(e.target.value)}
          placeholder="https://youtube.com/..."
          style={{ width: "100%", padding: "8px" }}
        />
      </div>

      <button
        onClick={handleSubmit}
        disabled={!apiKey}
        style={{
          padding: "10px 16px",
          backgroundColor: apiKey ? "#4CAF50" : "#aaa",
          color: "white",
          border: "none",
          cursor: apiKey ? "pointer" : "default"
        }}
      >
        ì—…ë¡œë“œ ì™„ë£Œ
      </button>
    </div>
  );
}
